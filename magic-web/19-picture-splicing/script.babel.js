function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Puzzle=function(){function Puzzle(elem,width,height){var images=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var piecesNum=arguments.length>4&&arguments[4]!==undefined?arguments[4]:160;var levels=arguments.length>5&&arguments[5]!==undefined?arguments[5]:8;_classCallCheck(this,Puzzle);_defineProperty(this,"pieces",[]);_defineProperty(this,"_images",[]);_defineProperty(this,"_imageIndex",0);this.elem=elem;var id=this.id=parseInt(Math.random()*(4294967295-268435455)+268435455).toString(16);elem.dataset[id]="";elem.style.position="relative";elem.style.top="0";elem.style.left="0";elem.style.opacity="0";this.$backgroundImage=document.createElement("style");document.head.append(this.$backgroundImage);this.width=width;this.maxOffsetX=width/20;this.height=height;this.maxOffsetY=height/20;this.images=images;this._preload();this.piecesNum=piecesNum;this.levels=levels;this.cx=width/2;this.cy=height/2;var $style=document.createElement("style");$style.innerText=this._compressCss("\n            [data-".concat(id,"] > * {\n                background-size: ").concat(width,"px ").concat(height,"px;\n                background-repeat: no-repeat;\n                position: absolute;\n                box-shadow: 0 0 20px 6px rgba(0, 0, 0, 0.4);\n            }\n            [data-").concat(id,"].in > * {\n                animation: in-").concat(id," 0.3s ease-out backwards;\n            }\n            [data-").concat(id,"].out > * {\n                animation: out-").concat(id," 0.3s ease-out forwards;\n            }\n            @keyframes in-").concat(id," {\n                from {\n                    opacity: 0;\n                    transform: translate3d(").concat(-width,"px, 0, 0) scale(1, 0);\n                }\n            }\n            @keyframes out-").concat(id," {\n                to {\n                    opacity: 0;\n                    transform: translate3d(").concat(width,"px, 0, 0) scale(1, 0);\n                }\n            }\n        "));document.head.append($style)}_createClass(Puzzle,[{key:"images",get:function get(){return this._images},set:function set(val){this._images=val;this._imageIndex=0;this._changeBackgroundImage()}},{key:"imageIndex",get:function get(){return this._imageIndex},set:function set(val){this._imageIndex=val;this._changeBackgroundImage()}},{key:"init",value:function init(){var _this=this;var elem=this.elem,pieces=this.pieces,piecesNum=this.piecesNum,images=this.images;for(var i=0;i<piecesNum;i++){var piece=pieces[i]={translateX:0,translateY:0};piece.elem=document.createElement("div");this._setPieceStyle(piece,i);elem.append(piece.elem)}var isClicked=false;elem.addEventListener("click",function(){if(!isClicked){isClicked=true;elem.classList.add("out")}});var animatedCount=0;elem.addEventListener("animationend",function(){animatedCount++;if(animatedCount===piecesNum){animatedCount=0;if(elem.classList.contains("out")){_this.imageIndex=(_this.imageIndex+1)%images.length;_this.reset();requestAnimationFrame(function(){elem.classList.remove("out");elem.classList.add("in")})}else if(elem.classList.contains("in")){elem.classList.remove("in");isClicked=false}}})}},{key:"parallax",value:function parallax(offsetXRatio,offsetYRatio){var maxOffsetX=this.maxOffsetX,maxOffsetY=this.maxOffsetY,levels=this.levels,piecesNum=this.piecesNum;this.pieces.forEach(function(piece,i){piece.translateX=offsetXRatio*maxOffsetX*(piece.zIndex/levels+i/piecesNum);piece.translateY=offsetYRatio*maxOffsetY*(piece.zIndex/levels+i/piecesNum);piece.elem.style.transform="translate3d(".concat(piece.translateX,"px,").concat(piece.translateY,"px,0)")})}},{key:"reset",value:function reset(){this.pieces.forEach(this._setPieceStyle.bind(this))}},{key:"_changeBackgroundImage",value:function _changeBackgroundImage(){this.$backgroundImage.innerText=this._compressCss("\n            [data-".concat(this.id,"] > * {\n                background-image: url(").concat(this.images[this.imageIndex],");\n            }\n        "))}},{key:"_setPieceStyle",value:function _setPieceStyle(piece,i){var cx=this.cx,cy=this.cy,levels=this.levels,piecesNum=this.piecesNum;var style=piece.elem.style;var zIndex=piece.zIndex=style.zIndex=Math.floor(Math.pow(i/piecesNum,1/3)*levels+1);var sizeRandom=Math.random();var width=piece.width=cx*((sizeRandom+levels-zIndex)/levels);var height=piece.height=cy*((sizeRandom+levels-zIndex)/levels);style.width=width+"px";style.height=height+"px";var radiusRandom=Math.random();var rad=Math.random()*Math.PI*2;var left=piece.left=cx*((radiusRandom+zIndex-1)/levels)*Math.cos(rad)-width/2;var top=piece.top=cy*((radiusRandom+zIndex-1)/levels)*Math.sin(rad)-height/2;style.left=left+"px";style.top=top+"px";style.backgroundPosition="".concat(-left-cx,"px ").concat(-top-cy,"px");style.animationDelay=(Math.random()+i/piecesNum)*0.5+"s"}},{key:"_compressCss",value:function _compressCss(css){return css.replace(/\s{2,}/," ").replace(/\s*[{};,>~=-]\s*|[(\[:]\s*|\s*[)\]]/g,function(match){return match.trim()}).trim()}},{key:"_preload",value:function _preload(){var _this2=this;var loadedCount=0;var onLoad=function onLoad(){loadedCount++;if(loadedCount===this.images.length){this.elem.style.transition="opacity 0.2s linear";this.elem.style.opacity="1";this.elem.addEventListener("transitionend",function ontransitionend(){this.style.transition="";this.style.opacity="";this.removeEventListener("transitionend",ontransitionend)})}};this.images.forEach(function(image){var img=document.createElement("img");img.src=image;img.addEventListener("load",onLoad.bind(_this2))})}}]);return Puzzle}();var size=Math.min(window.innerWidth,window.innerHeight);var puzzle=new Puzzle(document.querySelector(".box"),size,size,["./img/bg1.jpg","./img/bg2.jpg","./img/bg3.jpg"]);puzzle.imageIndex=Date.now()%3;puzzle.init();window.addEventListener("mousemove",function(e){puzzle.parallax(1-2*e.clientX/window.innerWidth,1-2*e.clientY/window.innerHeight)});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJQdXp6bGUiLCJlbGVtIiwid2lkdGgiLCJoZWlnaHQiLCJpbWFnZXMiLCJwaWVjZXNOdW0iLCJsZXZlbHMiLCJpZCIsInBhcnNlSW50IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwiZGF0YXNldCIsInN0eWxlIiwicG9zaXRpb24iLCJ0b3AiLCJsZWZ0Iiwib3BhY2l0eSIsIiRiYWNrZ3JvdW5kSW1hZ2UiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJoZWFkIiwiYXBwZW5kIiwibWF4T2Zmc2V0WCIsIm1heE9mZnNldFkiLCJfcHJlbG9hZCIsImN4IiwiY3kiLCIkc3R5bGUiLCJpbm5lclRleHQiLCJfY29tcHJlc3NDc3MiLCJfaW1hZ2VzIiwidmFsIiwiX2ltYWdlSW5kZXgiLCJfY2hhbmdlQmFja2dyb3VuZEltYWdlIiwicGllY2VzIiwiaSIsInBpZWNlIiwidHJhbnNsYXRlWCIsInRyYW5zbGF0ZVkiLCJfc2V0UGllY2VTdHlsZSIsImlzQ2xpY2tlZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGFzc0xpc3QiLCJhZGQiLCJhbmltYXRlZENvdW50IiwiY29udGFpbnMiLCJpbWFnZUluZGV4IiwibGVuZ3RoIiwicmVzZXQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJyZW1vdmUiLCJvZmZzZXRYUmF0aW8iLCJvZmZzZXRZUmF0aW8iLCJmb3JFYWNoIiwiekluZGV4IiwidHJhbnNmb3JtIiwiYmluZCIsImZsb29yIiwic2l6ZVJhbmRvbSIsInJhZGl1c1JhbmRvbSIsInJhZCIsIlBJIiwiY29zIiwic2luIiwiYmFja2dyb3VuZFBvc2l0aW9uIiwiYW5pbWF0aW9uRGVsYXkiLCJjc3MiLCJyZXBsYWNlIiwibWF0Y2giLCJ0cmltIiwibG9hZGVkQ291bnQiLCJvbkxvYWQiLCJ0cmFuc2l0aW9uIiwib250cmFuc2l0aW9uZW5kIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImltYWdlIiwiaW1nIiwic3JjIiwic2l6ZSIsIm1pbiIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsInB1enpsZSIsInF1ZXJ5U2VsZWN0b3IiLCJEYXRlIiwibm93IiwiaW5pdCIsImUiLCJwYXJhbGxheCIsImNsaWVudFgiLCJjbGllbnRZIl0sIm1hcHBpbmdzIjoiMHlCQUFNQSxDQUFBQSxNLFlBc0JGLGdCQUFZQyxJQUFaLENBQWtCQyxLQUFsQixDQUF5QkMsTUFBekIsQ0FBMkUsSUFBMUNDLENBQUFBLE1BQTBDLDJEQUFqQyxFQUFpQyxJQUE3QkMsQ0FBQUEsU0FBNkIsMkRBQWpCLEdBQWlCLElBQVpDLENBQUFBLE1BQVksMkRBQUgsQ0FBRyw0REFyQmxFLEVBcUJrRSxpQ0FuQmpFLEVBbUJpRSxxQ0FUN0QsQ0FTNkQsRUFDdkUsS0FBS0wsSUFBTCxDQUFZQSxJQUFaLENBQ0EsR0FBTU0sQ0FBQUEsRUFBRSxDQUFJLEtBQUtBLEVBQUwsQ0FBVUMsUUFBUSxDQUFDQyxJQUFJLENBQUNDLE1BQUwsSUFBaUIsV0FBYSxTQUE5QixFQUEyQyxTQUE1QyxDQUFSLENBQStEQyxRQUEvRCxDQUF3RSxFQUF4RSxDQUF0QixDQUNBVixJQUFJLENBQUNXLE9BQUwsQ0FBYUwsRUFBYixFQUFtQixFQUFuQixDQUNBTixJQUFJLENBQUNZLEtBQUwsQ0FBV0MsUUFBWCxDQUFzQixVQUF0QixDQUNBYixJQUFJLENBQUNZLEtBQUwsQ0FBV0UsR0FBWCxDQUFpQixHQUFqQixDQUNBZCxJQUFJLENBQUNZLEtBQUwsQ0FBV0csSUFBWCxDQUFrQixHQUFsQixDQUNBZixJQUFJLENBQUNZLEtBQUwsQ0FBV0ksT0FBWCxDQUFxQixHQUFyQixDQUVBLEtBQUtDLGdCQUFMLENBQXdCQyxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsT0FBdkIsQ0FBeEIsQ0FDQUQsUUFBUSxDQUFDRSxJQUFULENBQWNDLE1BQWQsQ0FBcUIsS0FBS0osZ0JBQTFCLEVBRUEsS0FBS2hCLEtBQUwsQ0FBYUEsS0FBYixDQUNBLEtBQUtxQixVQUFMLENBQWtCckIsS0FBSyxD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Q0FBQ2YsSUFBUCxDQUFZLE1BQVosQ0FBN0IsQ0FDSCxDQUpELENBS0gsQyxxQkFHTCxHQUFNc0IsQ0FBQUEsSUFBSSxDQUFHdEUsSUFBSSxDQUFDdUUsR0FBTCxDQUFTQyxNQUFNLENBQUNDLFVBQWhCLENBQTRCRCxNQUFNLENBQUNFLFdBQW5DLENBQWIsQ0FDQSxHQUFNQyxDQUFBQSxNQUFNLENBQUcsR0FBSXBGLENBQUFBLE1BQUosQ0FBV21CLFFBQVEsQ0FBQ2tFLGFBQVQsQ0FBdUIsTUFBdkIsQ0FBWCxDQUEyQ04sSUFBM0MsQ0FBaURBLElBQWpELENBQXVELENBQ2xFLGVBRGtFLENBRWxFLGVBRmtFLENBR2xFLGVBSGtFLENBQXZELENBQWYsQ0FLQUssTUFBTSxDQUFDckMsVUFBUCxDQUFvQnVDLElBQUksQ0FBQ0MsR0FBTCxHQUFhLENBQWpDLENBQ0FILE1BQU0sQ0FBQ0ksSUFBUCxHQUVBUCxNQUFNLENBQUN2QyxnQkFBUCxDQUF3QixXQUF4QixDQUFxQyxTQUFVK0MsQ0FBVixDQUFhLENBQzlDTCxNQUFNLENBQUNNLFFBQVAsQ0FBZ0IsRUFBSyxFQUFJRCxDQUFDLENBQUNFLE9BQVAsQ0FBa0JWLE1BQU0sQ0FBQ0MsVUFBN0MsQ0FBeUQsRUFBSyxFQUFJTyxDQUFDLENBQUNHLE9BQVAsQ0FBa0JYLE1BQU0sQ0FBQ0UsV0FBdEYsQ0FDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgUHV6emxlIHtcclxuICAgIHBpZWNlcyA9IFtdOyAvLyDmiYDmnInnoo7niYdcclxuXHJcbiAgICBfaW1hZ2VzID0gW107XHJcbiAgICBnZXQgaW1hZ2VzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbWFnZXM7XHJcbiAgICB9XHJcbiAgICBzZXQgaW1hZ2VzKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2ltYWdlcyA9IHZhbDtcclxuICAgICAgICB0aGlzLl9pbWFnZUluZGV4ID0gMDtcclxuICAgICAgICB0aGlzLl9jaGFuZ2VCYWNrZ3JvdW5kSW1hZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBfaW1hZ2VJbmRleCA9IDA7XHJcbiAgICBnZXQgaW1hZ2VJbmRleCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VJbmRleDtcclxuICAgIH1cclxuICAgIHNldCBpbWFnZUluZGV4KHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2ltYWdlSW5kZXggPSB2YWw7XHJcbiAgICAgICAgdGhpcy5fY2hhbmdlQmFja2dyb3VuZEltYWdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoZWxlbSwgd2lkdGgsIGhlaWdodCwgaW1hZ2VzID0gW10sIHBpZWNlc051bSA9IDE2MCwgbGV2ZWxzID0gOCkge1xyXG4gICAgICAgIHRoaXMuZWxlbSA9IGVsZW07XHJcbiAgICAgICAgY29uc3QgaWQgPSAodGhpcy5pZCA9IHBhcnNlSW50KE1hdGgucmFuZG9tKCkgKiAoMHhmZmZmZmZmZiAtIDB4ZmZmZmZmZikgKyAweGZmZmZmZmYpLnRvU3RyaW5nKDE2KSk7XHJcbiAgICAgICAgZWxlbS5kYXRhc2V0W2lkXSA9ICcnO1xyXG4gICAgICAgIGVsZW0uc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xyXG4gICAgICAgIGVsZW0uc3R5bGUudG9wID0gJzAnO1xyXG4gICAgICAgIGVsZW0uc3R5bGUubGVmdCA9ICcwJztcclxuICAgICAgICBlbGVtLnN0eWxlLm9wYWNpdHkgPSAnMCc7XHJcblxyXG4gICAgICAgIHRoaXMuJGJhY2tncm91bmRJbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XHJcbiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmQodGhpcy4kYmFja2dyb3VuZEltYWdlKTtcclxuXHJcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHRoaXMubWF4T2Zmc2V0WCA9IHdpZHRoIC8gMjA7XHJcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgdGhpcy5tYXhPZmZzZXRZID0gaGVpZ2h0IC8gMjA7XHJcblxyXG4gICAgICAgIHRoaXMuaW1hZ2VzID0gaW1hZ2VzO1xyXG4gICAgICAgIHRoaXMuX3ByZWxvYWQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5waWVjZXNOdW0gPSBwaWVjZXNOdW07XHJcbiAgICAgICAgdGhpcy5sZXZlbHMgPSBsZXZlbHM7XHJcblxyXG4gICAgICAgIHRoaXMuY3ggPSB3aWR0aCAvIDI7XHJcbiAgICAgICAgdGhpcy5jeSA9IGhlaWdodCAvIDI7XHJcblxyXG4gICAgICAgIGNvbnN0ICRzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XHJcbiAgICAgICAgJHN0eWxlLmlubmVyVGV4dCA9IHRoaXMuX2NvbXByZXNzQ3NzKGBcclxuICAgICAgICAgICAgW2RhdGEtJHtpZH1dID4gKiB7XHJcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLXNpemU6ICR7d2lkdGh9cHggJHtoZWlnaHR9cHg7XHJcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0O1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xyXG4gICAgICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDIwcHggNnB4IHJnYmEoMCwgMCwgMCwgMC40KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBbZGF0YS0ke2lkfV0uaW4gPiAqIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogaW4tJHtpZH0gMC4zcyBlYXNlLW91dCBiYWNrd2FyZHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgW2RhdGEtJHtpZH1dLm91dCA+ICoge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBvdXQtJHtpZH0gMC4zcyBlYXNlLW91dCBmb3J3YXJkcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBAa2V5ZnJhbWVzIGluLSR7aWR9IHtcclxuICAgICAgICAgICAgICAgIGZyb20ge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgkey13aWR0aH1weCwgMCwgMCkgc2NhbGUoMSwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQGtleWZyYW1lcyBvdXQtJHtpZH0ge1xyXG4gICAgICAgICAgICAgICAgdG8ge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgke3dpZHRofXB4LCAwLCAwKSBzY2FsZSgxLCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIGApO1xyXG4gICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kKCRzdHlsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBjb25zdCB7IGVsZW0sIHBpZWNlcywgcGllY2VzTnVtLCBpbWFnZXMgfSA9IHRoaXM7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGllY2VzTnVtOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgcGllY2UgPSAocGllY2VzW2ldID0ge1xyXG4gICAgICAgICAgICAgICAgdHJhbnNsYXRlWDogMCxcclxuICAgICAgICAgICAgICAgIHRyYW5zbGF0ZVk6IDAsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBwaWVjZS5lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3NldFBpZWNlU3R5bGUocGllY2UsIGkpO1xyXG4gICAgICAgICAgICBlbGVtLmFwcGVuZChwaWVjZS5lbGVtKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBpc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWlzQ2xpY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgaXNDbGlja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnb3V0Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgYW5pbWF0ZWRDb3VudCA9IDA7XHJcbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdhbmltYXRpb25lbmQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGFuaW1hdGVkQ291bnQrKztcclxuICAgICAgICAgICAgaWYgKGFuaW1hdGVkQ291bnQgPT09IHBpZWNlc051bSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0ZWRDb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoJ291dCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZUluZGV4ID0gKHRoaXMuaW1hZ2VJbmRleCArIDEpICUgaW1hZ2VzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdvdXQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucygnaW4nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnaW4nKTtcclxuICAgICAgICAgICAgICAgICAgICBpc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHBhcmFsbGF4KG9mZnNldFhSYXRpbywgb2Zmc2V0WVJhdGlvKSB7XHJcbiAgICAgICAgY29uc3QgeyBtYXhPZmZzZXRYLCBtYXhPZmZzZXRZLCBsZXZlbHMsIHBpZWNlc051bSB9ID0gdGhpcztcclxuICAgICAgICB0aGlzLnBpZWNlcy5mb3JFYWNoKChwaWVjZSwgaSkgPT4ge1xyXG4gICAgICAgICAgICBwaWVjZS50cmFuc2xhdGVYID0gb2Zmc2V0WFJhdGlvICogbWF4T2Zmc2V0WCAqIChwaWVjZS56SW5kZXggLyBsZXZlbHMgKyBpIC8gcGllY2VzTnVtKTsgLy8g5bGC57qn6LaK6auY44CB57Si5byV6LaK5aSn77yM5YGP56e76YeP6LaK5aSnXHJcbiAgICAgICAgICAgIHBpZWNlLnRyYW5zbGF0ZVkgPSBvZmZzZXRZUmF0aW8gKiBtYXhPZmZzZXRZICogKHBpZWNlLnpJbmRleCAvIGxldmVscyArIGkgLyBwaWVjZXNOdW0pO1xyXG4gICAgICAgICAgICBwaWVjZS5lbGVtLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUzZCgke3BpZWNlLnRyYW5zbGF0ZVh9cHgsJHtwaWVjZS50cmFuc2xhdGVZfXB4LDApYDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldCgpIHtcclxuICAgICAgICB0aGlzLnBpZWNlcy5mb3JFYWNoKHRoaXMuX3NldFBpZWNlU3R5bGUuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoYW5nZUJhY2tncm91bmRJbWFnZSgpIHtcclxuICAgICAgICB0aGlzLiRiYWNrZ3JvdW5kSW1hZ2UuaW5uZXJUZXh0ID0gdGhpcy5fY29tcHJlc3NDc3MoYFxyXG4gICAgICAgICAgICBbZGF0YS0ke3RoaXMuaWR9XSA+ICoge1xyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7dGhpcy5pbWFnZXNbdGhpcy5pbWFnZUluZGV4XX0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgYCk7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldFBpZWNlU3R5bGUocGllY2UsIGkpIHtcclxuICAgICAgICBjb25zdCB7IGN4LCBjeSwgbGV2ZWxzLCBwaWVjZXNOdW0gfSA9IHRoaXM7XHJcblxyXG4gICAgICAgIGNvbnN0IHN0eWxlID0gcGllY2UuZWxlbS5zdHlsZTtcclxuXHJcbiAgICAgICAgY29uc3QgekluZGV4ID0gKHBpZWNlLnpJbmRleCA9IHN0eWxlLnpJbmRleCA9IE1hdGguZmxvb3IoKGkgLyBwaWVjZXNOdW0pICoqICgxIC8gMykgKiBsZXZlbHMgKyAxKSk7IC8vIOmdnuWdh+WMgOWIhuW4g++8jOWxgue6p+i2iumrmO+8jOeijueJh+aVsOmHj+i2iuWkmlxyXG5cclxuICAgICAgICBjb25zdCBzaXplUmFuZG9tID0gTWF0aC5yYW5kb20oKTtcclxuICAgICAgICBjb25zdCB3aWR0aCA9IChwaWVjZS53aWR0aCA9IGN4ICogKChzaXplUmFuZG9tICsgbGV2ZWxzIC0gekluZGV4KSAvIGxldmVscykpOyAvLyDlsYLnuqfotorpq5jvvIzlsLrlr7jotorlsI9cclxuICAgICAgICBjb25zdCBoZWlnaHQgPSAocGllY2UuaGVpZ2h0ID0gY3kgKiAoKHNpemVSYW5kb20gKyBsZXZlbHMgLSB6SW5kZXgpIC8gbGV2ZWxzKSk7XHJcbiAgICAgICAgc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7XHJcbiAgICAgICAgc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JztcclxuXHJcbiAgICAgICAgY29uc3QgcmFkaXVzUmFuZG9tID0gTWF0aC5yYW5kb20oKTtcclxuICAgICAgICBjb25zdCByYWQgPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDI7IC8vIOmaj+acuueahOinkuW6pu+8jOeijueJh+WwhuWIhuW4g+WcqOWuueWZqOeahOWGheWIh+akreWchuS4rVxyXG4gICAgICAgIGNvbnN0IGxlZnQgPSAocGllY2UubGVmdCA9IGN4ICogKChyYWRpdXNSYW5kb20gKyB6SW5kZXggLSAxKSAvIGxldmVscykgKiBNYXRoLmNvcyhyYWQpIC0gd2lkdGggLyAyKTsgLy8g5bGC57qn6LaK6auY77yM6Led56a75Lit5b+D6LaK6L+cXHJcbiAgICAgICAgY29uc3QgdG9wID0gKHBpZWNlLnRvcCA9IGN5ICogKChyYWRpdXNSYW5kb20gKyB6SW5kZXggLSAxKSAvIGxldmVscykgKiBNYXRoLnNpbihyYWQpIC0gaGVpZ2h0IC8gMik7XHJcbiAgICAgICAgc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xyXG4gICAgICAgIHN0eWxlLnRvcCA9IHRvcCArICdweCc7XHJcbiAgICAgICAgc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gYCR7LWxlZnQgLSBjeH1weCAkey10b3AgLSBjeX1weGA7XHJcbiAgICAgICAgc3R5bGUuYW5pbWF0aW9uRGVsYXkgPSAoTWF0aC5yYW5kb20oKSArIGkgLyBwaWVjZXNOdW0pICogMC41ICsgJ3MnO1xyXG4gICAgfVxyXG5cclxuICAgIF9jb21wcmVzc0Nzcyhjc3MpIHtcclxuICAgICAgICByZXR1cm4gY3NzXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXHN7Mix9LywgJyAnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFxzKlt7fTssPn49LV1cXHMqfFsoXFxbOl1cXHMqfFxccypbKVxcXV0vZywgbWF0Y2ggPT4gbWF0Y2gudHJpbSgpKVxyXG4gICAgICAgICAgICAudHJpbSgpO1xyXG4gICAgfVxyXG5cclxuICAgIF9wcmVsb2FkKCkge1xyXG4gICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7XHJcbiAgICAgICAgY29uc3Qgb25Mb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBsb2FkZWRDb3VudCsrO1xyXG4gICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IHRoaXMuaW1hZ2VzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtLnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAwLjJzIGxpbmVhcic7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW0uc3R5bGUub3BhY2l0eSA9ICcxJztcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbS5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgZnVuY3Rpb24gb250cmFuc2l0aW9uZW5kKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUudHJhbnNpdGlvbiA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUub3BhY2l0eSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIG9udHJhbnNpdGlvbmVuZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5pbWFnZXMuZm9yRWFjaChpbWFnZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgICAgICAgICBpbWcuc3JjID0gaW1hZ2U7XHJcbiAgICAgICAgICAgIGltZy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgb25Mb2FkLmJpbmQodGhpcykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBzaXplID0gTWF0aC5taW4od2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XHJcbmNvbnN0IHB1enpsZSA9IG5ldyBQdXp6bGUoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJveCcpLCBzaXplLCBzaXplLCBbXHJcbiAgICAnLi9pbWcvYmcxLmpwZycsXHJcbiAgICAnLi9pbWcvYmcyLmpwZycsXHJcbiAgICAnLi9pbWcvYmczLmpwZycsXHJcbl0pO1xyXG5wdXp6bGUuaW1hZ2VJbmRleCA9IERhdGUubm93KCkgJSAzO1xyXG5wdXp6bGUuaW5pdCgpO1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICBwdXp6bGUucGFyYWxsYXgoMSAtICgyICogZS5jbGllbnRYKSAvIHdpbmRvdy5pbm5lcldpZHRoLCAxIC0gKDIgKiBlLmNsaWVudFkpIC8gd2luZG93LmlubmVySGVpZ2h0KTtcclxufSk7XHJcbiJdfQ==